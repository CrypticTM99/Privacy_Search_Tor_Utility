import requests
import base64

VIRUS_TOTAL_API_KEY = 'dc1c8f2114a7a72df4b16716f58594eba825be17b5cd2781ffbfe979d9079e72'

def scan_url_for_malware(url):
    base_url = "https://www.virustotal.com/api/v3/urls"
    
    # Encode the URL
    url_encoded = base64.urlsafe_b64encode(url.encode()).decode().strip("=")
    
    headers = {
        "x-apikey": VIRUS_TOTAL_API_KEY
    }
    
    try:
        response = requests.get(f"{base_url}/{url_encoded}", headers=headers)
        data = response.json()

        if 'data' in data:
            malicious_count = data['data']['attributes']['last_analysis_stats']['malicious']
            if malicious_count > 0:
                print("Warning: The URL is flagged as malicious!")
                return True
            else:
                print("The URL is safe.")
                return False
        else:
            print("Error scanning the URL.")
            return False
    except Exception as e:
        print(f"Error scanning URL: {e}")
        return False
